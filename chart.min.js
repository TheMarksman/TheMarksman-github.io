var Chart=function(){var t,n={top:20,right:10,bottom:20,left:10},e=d3.dispatch(),a=225,r=100,i=.1,o=1,l=.005,s=function(){return-0},c=.02,u=0,d=30,f=5,p="domain",y="startDate",x=d3.scale.category10(),h=function(h){h.each(function(h){function g(t){var n=t.pathSegList;return d3.range(n.numberOfItems-1).map(function(t){return[n.getItem(t).x,n.getItem(t).y]})}function m(n){var e=.1*n.alpha;h.forEach(function(n){var a=[n.x-R.x,n.y-R.y],r=j[n[t]],i=(Math.sqrt(Math.pow(a[0]-r[0],2),Math.pow(a[1]-r[1],2)),v(a,W[n[t]]));i?(n.x+=(r[0]-a[0])*e,n.y+=(r[1]-a[1])*e):(n.x+=(a[0]<r[0]?1:-1)*o,n.y+=(a[1]<r[1]?1:-1)*o)}),an.each(A(.5)).attr("x",function(t){return t.x}).attr("y",function(t){return t.y})}function v(t,n){for(var e=t[0],a=t[1],r=!1,i=0,o=n.length-1;i<n.length;o=i++){var l=n[i][0],s=n[i][1],c=n[o][0],u=n[o][1],d=s>a!=u>a&&(c-l)*(a-s)/(u-s)+l>e;d&&(r=!r)}return r}function A(t){var n=d3.geom.quadtree(h);return function(e){var a=e.radius+f,r=e.x-a,i=e.x+a,o=e.y-a,l=e.y+a;n.visit(function(n,a,s,c,u){if(n.point&&n.point!==e){var d=e.x-n.point.x,p=e.y-n.point.y,y=Math.sqrt(d*d+p*p),x=e.radius+n.point.radius+f;x>y&&(y=(y-x)/y*t,e.x-=d*=y,e.y-=p*=y,n.point.x+=d,n.point.y+=p)}return a>i||r>c||s>l||o>u})}}function b(){Y.stop()}var w=d3.select(this),k=this.clientWidth,O=this.clientHeight,L=k-n.left-n.right,C=O-n.top-n.bottom,R={x:L/2,y:C/2},M=15,D=20,h=_.sortByOrder(h,[p,y],["asc","desc"]),E=_.countBy(h,t),I=_.size(E),q=_.groupBy(h,t),N={},z=a+d/2,B=2*Math.sin(Math.PI/I)*z,S=[{x:0,y:0},{x:B/2,y:0},{x:B,y:0}],T=[{x:0,y:0},{x:B/2,y:-d},{x:B,y:0}],U=0;_.forEach(E,function(t,n){var e=U+D,a=e+t*M*1.05;N[n]={textLocation:U,scale:d3.scale.ordinal().domain(_.map(q[n],"name")).range(d3.range(e,a,(a-e)/t))},U=a+D});var P,H=_.chain(h).map(function(n){return n[t]}).uniq().value(),J=M/2,W=[],j=[],F=d3.layout.pie().value(function(){return 1}),G=d3.svg.arc().innerRadius(0).outerRadius(a),K=d3.svg.arc().innerRadius(r).padAngle(i).outerRadius(a),Q=d3.svg.arc().innerRadius(a).padAngle(l).outerRadius(a+d),V=d3.svg.line().x(function(t){return t.x}).y(function(t){return tn(t.y)}).interpolate("linear"),X=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y}).interpolate("basis"),Y=d3.layout.force().gravity(c).friction(u).charge(s).size([k,O]),Z=d3.time.scale().domain([d3.min(h,function(t){return t.startDate}),d3.max(h,function(t){return t.lastUpdate})]).range([n.left,L]).nice(),$=d3.svg.axis().scale(Z).orient("bottom"),tn=d3.scale.ordinal().domain(H).range(_.map(N,function(t){return t.textLocation})),nn=w.append("svg").attr("width",k).attr("height",O).style("overflow","visible"),en=nn.append("g").classed({timeline:1});en.append("g").attr("transform","translate("+[0,C]+")").classed({"x-axis":1}).call($);en.append("g").selectAll(".timeline-line").data(H).call(function(e){e.enter().append("path").classed({"timeline-line":1}).attr({d:function(t){return V([{x:n.left,y:t},{x:n.left,y:t}])}}).style({stroke:function(n){return x(n[t])},"stroke-width":"1px",opacity:.4})}),nn.append("g").attr("transform","translate("+[R.x,R.y]+")").selectAll(".region").data(F(H)).call(function(t){t.enter().append("path").classed({"region region-background":1}).attr("d",G)}),nn.append("g").attr("transform","translate("+[R.x,R.y]+")").selectAll(".region").data(F(H)).call(function(t){t.enter().append("path").classed({region:1}).attr("d",K).style({fill:"none"}).each(function(t){W[t.data]=g(this),j[t.data]=K.centroid(t)})}),nn.append("g").attr("transform","translate("+[R.x,R.y]+")").selectAll(".text-background").data(F(H)).call(function(t){var n=t.enter().append("g").classed({"region text-background":1});n.append("path").classed({"text-background-arc":1}).attr({d:Q}).style({fill:"#b5bdc3",opacity:1})}),nn.append("g").selectAll(".text-group").data(F(H)).call(function(t){var n=t.enter().append("g").classed({"text-translate":1}).attr({transform:"translate("+[R.x-B/2,R.y-a]+")"}).append("g").classed({"text-rotate":1}).attr({transform:function(t,n){return"rotate("+[n*(360/I)+360/I/2,B/2,a]+")"}}),e=n.append("text").classed({"display-text":1}).attr({dy:d/2-3});n.append("path").classed({"path-for-text":1}).style({fill:"none"}).attr({d:X(T),id:function(t,n){return"path"+n}}),e.append("textPath").classed({"text-path":1}).attr({startOffset:"50%","xlink:href":function(t,n){return"#path"+n}}).style({"text-anchor":"middle"}).append("tspan").classed({"actual-text-path":1}).style({"font-size":"12pt",fill:"white",opacity:.87}).text(function(t){return t.data})});h.forEach(function(n){var e=j[n[t]];n.x=e[0]+R.x,n.y=e[1]+R.y,n.radius=J}),Y.nodes(h).on("tick",m).start();var an=nn.selectAll(".node").data(h).call(function(n){function a(t){var n=d3.select("#"+_.kebabCase(t.name)),e=P?P.data()[0]===n.data()[0]:!1;P&&P.style({stroke:null}),e?P=null:(P=n,P.style({stroke:"black","stroke-width":"2px"}))}function r(t){var n=d3.select(this);"0"!==n.style("opacity")&&(d3.select(this).style({opacity:.6}),e.mouseOverNode(t))}function i(t){var n=d3.select(this);"0"!==n.style("opacity")&&(n.style({opacity:1}),e.mouseOutNode(t))}n.enter().append("rect").classed({node:1}).attr({id:function(t){return _.kebabCase(t.name)}}).style({opacity:0,fill:function(n){return x(n[t])}}),n.transition().duration(750).attr({width:M,height:M,rx:M/2,ry:M/2}).style("opacity",1),e.on("selectedNode.highlight",a),n.on("mouseover",r),n.on("mouseout",i)}).call(Y.drag);e.on("drawDomain",function(){function t(){return function(t,n,e){return d3.interpolate(e,X(T))}}var e=w.transition().duration(500);e.selectAll(".node").attr({width:M}),e.selectAll(".timeline-line").attr({d:function(t){return V([{x:n.left,y:t},{x:n.left,y:t}])}}),e.selectAll(".timeline").style({opacity:0});var r=e.transition().duration(500);r.selectAll(".node").attr({x:function(t){return t.x},y:function(t){return t.y}}),r.each("end",function(){an.call(Y.drag),Y.start()});var i=r.transition().delay(function(t,n){return 50*n}).delay(1e3).duration(1e3);i.selectAll(".text-translate").attr({transform:"translate("+[R.x-B/2,R.y-a]+")"}),i.selectAll(".text-rotate").attr({transform:function(t,n){return"rotate("+[n*(360/I)+360/I/2,B/2,a]+")"}});var o=i.transition().delay(1500).duration(750);o.selectAll(".text-path").attr({startOffset:"50%"}),o.selectAll(".text-path").style({"text-anchor":"middle"}),o.selectAll(".display-text").attr({dy:d/2-3}),o.selectAll(".path-for-text").attrTween("d",t());var l=o.transition();l.selectAll(".text-translate").attr({transform:"translate("+[R.x-B/2,R.y-a]+")"}),l.selectAll(".text-background").selectAll("path").style({opacity:1}),l.selectAll(".region-background").style({opacity:1}),l.selectAll(".actual-text-path").style({fill:"white"})}),e.on("drawTimeline",function(){function e(){Y.stop(),an.call(rn)}function a(){w.selectAll(".text-background").selectAll("path").transition().style("opacity",0)}function r(){w.selectAll(".region-background").transition().style("opacity",0)}function i(){w.selectAll(".actual-text-path").transition().style({fill:function(t){return x(t.data)}})}function o(){w.selectAll(".text-translate").transition().duration(1e3).attr({transform:function(t){return"translate("+[R.x,N[t.data].textLocation]+")"}})}function l(){w.selectAll(".text-rotate").transition().attr({transform:function(){return"rotate(0)"}})}function s(){function t(){return function(t,n,e){return d3.interpolate(e,X(S))}}w.selectAll(".path-for-text").transition().attrTween("d",t())}function c(){w.selectAll(".text-path").transition().style({"text-anchor":"start"}),w.selectAll(".text-path").transition().attr({startOffset:"0%"}),w.selectAll(".display-text").transition().attr({dy:16})}function u(){w.selectAll(".text-translate").transition().duration(500).attr({transform:function(t){return"translate("+[n.left,N[t.data].textLocation]+")"}})}function d(){w.selectAll(".timeline").transition().style("opacity",1)}function f(){an.transition().attr({x:function(t){return Z(t.startDate)-M/2},y:function(n){return N[n[t]].scale(n.name)}})}function p(){w.selectAll(".timeline-line").transition().attr({d:function(t){return V([{x:n.left,y:t},{x:L,y:t}])}})}function y(){an.transition().attr({width:function(t){return Z(t.lastUpdate)-Z(t.startDate)+M}})}e(),d3.transition().ease("linear").each(function(){a(),r(),i()}).transition().duration(500).each(function(){o(),l(),s(),c()}).each("end",function(){u()}).transition().delay(1500).duration(500).each(function(){f()}).each("end",function(){d(),p(),y()})}),e.on("filterUpdate",function(t){function n(n){if(!e()){var a=!0,r={};return _.forIn(t,function(e,a){if("others"!==a&&!_.isEmpty(e))if(r[a]=!1,"all"===a){var i=JSON.stringify(_.values(n)).toLowerCase();if(-1!==i.indexOf(e))return void(r[a]=!0)}else{var o=_.some(e,function(e){return _.isArray(n[a])?"other"===e?_.some(n[a],function(n){return _.some(t.others,function(t){return n===t})}):_.some(n[a],function(t){return-1!==t.toLowerCase().indexOf(e)}):"other"===e?_.some(t.others,function(t){return n[a].toLowerCase()===t}):-1!==n[a].toLowerCase().indexOf(e)});if(o)return void(r[a]=!0)}}),a=!_.every(_.values(r),function(t){return t}),a?0:1}return 1}function e(){return _.every(t,function(t){return _.isEmpty(t)})}an.transition().style({opacity:function(t){return n(t)},"pointer-events":function(t){return n(t)?"all":"none"}})});var rn=d3.behavior.drag().on("dragstart",b)})};return h.margin=function(t){return arguments.length?(n=t,h):n},h.regionAttribute=function(n){return arguments.length?(t=n,h):t},h.pieRadius=function(t){return arguments.length?(a=t,h):a},h.dispatcher=function(t){return arguments.length?(e=t,h):e},h.colorScheme=function(t){return arguments.length?(x=t,h):x},h};
//# sourceMappingURL=chart.min.js.map